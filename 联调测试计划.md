# 联调测试计划

## 📋 测试前准备检查清单

### ✅ 已完成
- [x] 前端API对接完成
- [x] 后端OTA PID配置文档准备完成
- [x] 封面图片占位图方案完成

### ⚠️ 需要手动完成（5-10分钟）

#### 1. 前端环境变量配置
**负责人：前端工程师**

在 `frontend/.env.local` 创建文件：
```
NEXT_PUBLIC_API_URL=http://localhost:3001
```

#### 2. 后端OTA PID配置
**负责人：后端工程师**

在 `backend/.env` 创建文件：
```
PORT=3001
OTA_PID=你的携程PID
```

**如果没有携程PID：**
- 先用测试PID：`OTA_PID=TEST_PID`
- 不影响功能测试，但链接不会产生佣金
- 上线前必须配置真实PID

---

## 🧪 联调测试步骤

### 第1步：启动服务（5分钟）

**终端1：启动后端**
```bash
cd backend
npm install  # 如果还没安装
npm run dev
```

**验证：**
- 访问 http://localhost:3001/health
- 应该返回 `{"status":"ok"}`

**终端2：启动前端**
```bash
cd frontend
npm install  # 如果还没安装
npm run dev
```

**验证：**
- 访问 http://localhost:3000
- 应该看到推荐列表

---

### 第2步：功能测试（15分钟）

#### 测试1：首页推荐列表
- [ ] 打开 http://localhost:3000
- [ ] 看到【本周推荐】标签和推荐卡片
- [ ] 看到【本月推荐】标签和推荐卡片
- [ ] 看到【学生常选】标签和推荐卡片
- [ ] 卡片显示城市名称、预算、交通、天气等信息
- [ ] 卡片显示信任信号（1-2个）
- [ ] 卡片显示CTA按钮："查看学生最低价"
- [ ] 占位图正常显示（渐变背景）

**预期结果：**
- 推荐列表正常显示
- 卡片信息完整
- 占位图美观

#### 测试2：推荐卡片点击
- [ ] 点击任意推荐卡片
- [ ] 跳转到详情页
- [ ] 详情页正常加载
- [ ] 显示目的地名称和一句话结论
- [ ] 显示信任信号
- [ ] 显示推荐理由（3条）
- [ ] 显示参考行程
- [ ] 显示3个CTA按钮

**预期结果：**
- 详情页正常显示
- 信息完整清晰

#### 测试3：CTA按钮跳转
- [ ] 点击"查看学生最低价（携程）"按钮
- [ ] 在新窗口打开携程链接
- [ ] 检查链接URL是否包含PID参数
- [ ] 点击"现在去订（高铁/机票）"按钮
- [ ] 在新窗口打开携程链接
- [ ] 点击"查看优惠套餐"按钮
- [ ] 在新窗口打开携程链接

**预期结果：**
- 所有CTA按钮能正常跳转
- 链接格式正确
- 如果配置了真实PID，链接应包含PID

#### 测试4：加载和错误状态
- [ ] 刷新页面，观察加载状态（骨架屏）
- [ ] 停止后端服务，观察错误状态
- [ ] 检查错误提示是否友好
- [ ] 检查是否有重试按钮

**预期结果：**
- 加载状态正常显示
- 错误状态有友好提示
- 可以重试

#### 测试5：移动端测试
- [ ] 打开浏览器开发者工具
- [ ] 切换到移动端视图（iPhone/Android）
- [ ] 检查布局是否正常
- [ ] 检查点击区域是否足够大（≥44px）
- [ ] 检查CTA按钮是否在可视区
- [ ] 测试点击操作

**预期结果：**
- 移动端布局正常
- 点击区域足够大
- 体验良好

---

### 第3步：数据验证（10分钟）

#### 验证1：推荐数据
- [ ] 检查推荐列表是否包含20个城市
- [ ] 检查每个城市数据是否完整
- [ ] 检查primary_reason字段是否显示
- [ ] 检查信任信号数据是否正确

#### 验证2：详情数据
- [ ] 检查详情页数据是否完整
- [ ] 检查推荐理由是否清晰
- [ ] 检查行程是否合理
- [ ] 检查CTA文案是否"像钱"

#### 验证3：OTA链接
- [ ] 检查链接格式是否正确
- [ ] 检查是否包含utm_source参数
- [ ] 检查是否包含PID参数（如果已配置）

---

## 🐛 常见问题排查

### 问题1：前端无法连接后端
**症状：** 推荐列表不显示，控制台报错

**排查：**
1. 检查后端是否启动（http://localhost:3001/health）
2. 检查前端.env.local文件是否存在
3. 检查NEXT_PUBLIC_API_URL是否正确
4. 检查CORS设置（后端已配置）

**解决：**
- 确保后端服务运行
- 确保环境变量配置正确
- 重启前端服务

### 问题2：OTA链接不包含PID
**症状：** 链接中显示YOUR_PID或TEST_PID

**排查：**
1. 检查backend/.env文件是否存在
2. 检查OTA_PID是否配置
3. 检查服务是否重启（修改.env后需重启）

**解决：**
- 配置真实PID或使用TEST_PID测试
- 重启后端服务

### 问题3：占位图不显示
**症状：** 卡片没有背景图

**排查：**
1. 检查cityGradients.ts文件是否存在
2. 检查组件是否正确导入
3. 检查控制台是否有错误

**解决：**
- 检查代码是否正确
- 重启前端服务

---

## ✅ 测试验收标准

### 功能验收
- [x] 首页推荐正常显示
- [ ] 详情页正常显示
- [ ] CTA能正常跳转
- [ ] 加载状态正常
- [ ] 错误状态正常
- [ ] 移动端体验良好

### 数据验收
- [ ] 20个城市数据完整
- [ ] 文案质量达标
- [ ] 信任信号数据正确
- [ ] primary_reason字段显示

### 链接验收
- [ ] OTA链接格式正确
- [ ] 链接能正常跳转
- [ ] 链接包含必要参数

---

## 📝 测试报告模板

### 测试结果
- **测试时间：** [填写]
- **测试人员：** [填写]
- **测试环境：** 本地开发环境

### 功能测试结果
- 首页推荐列表：✅/❌
- 详情页显示：✅/❌
- CTA跳转：✅/❌
- 加载状态：✅/❌
- 错误状态：✅/❌
- 移动端：✅/❌

### 发现的问题
1. [问题描述]
   - 严重程度：[高/中/低]
   - 状态：[待修复/已修复]

### 下一步行动
- [ ] 修复发现的问题
- [ ] 准备部署
- [ ] 安排上线

---

## 🎯 测试目标

**核心目标：验证"能点出去"**

1. ✅ 首页能正常显示推荐
2. ✅ 详情页能正常显示
3. ✅ CTA按钮能正常跳转
4. ✅ 移动端体验良好

**如果以上4点都通过，即可进入部署阶段。**

---

**开始时间：现在**
**预计时间：30-40分钟**
**负责人：前端工程师 + 后端工程师**

