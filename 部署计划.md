# 部署计划

## ✅ 测试结果确认

### 核心验收（全部通过）
- [x] 首页推荐正常显示
- [x] 详情页正常显示
- [x] CTA能正常跳转
- [x] 移动端体验良好

### 测试统计
- **功能测试：** 6/6 通过（100%）
- **数据验证：** 3/3 通过（100%）
- **总体通过率：** 100%（9/9）

### 上线评估
**是否可上线：✅ 可以上线**

**评估依据：**
- 所有核心功能测试通过
- 所有数据验证通过
- 移动端体验良好
- 无高优先级问题
- OTA链接正确，返佣链接已生效（PID: 284116645）

---

## 🚀 部署方案

### 前端部署：Vercel（推荐）

**优势：**
- 免费，自动部署
- Next.js官方推荐
- 自动HTTPS
- 全球CDN加速

**部署步骤：**
1. 连接GitHub仓库
2. 配置环境变量
3. 自动部署

### 后端部署：Railway / Render（推荐）

**Railway优势：**
- 免费额度充足
- 自动部署
- 环境变量管理方便

**Render优势：**
- 免费套餐可用
- 自动HTTPS
- 简单易用

---

## 📋 部署任务清单

### 第1步：准备生产环境配置（30分钟）

#### 前端环境变量
**负责人：前端工程师**

在Vercel项目设置中配置：
```
NEXT_PUBLIC_API_URL=https://你的后端域名
```

**获取方式：**
- 后端部署完成后获取URL
- 配置到Vercel环境变量

#### 后端环境变量
**负责人：后端工程师**

在生产环境配置：
```
PORT=3001
OTA_PID=284116645
NODE_ENV=production
```

**注意：**
- 使用真实PID（284116645）
- 确保环境变量正确配置

---

### 第2步：前端部署（15分钟）

**负责人：前端工程师**

**部署步骤：**
1. **连接GitHub**
   - 访问 https://vercel.com
   - 使用GitHub账号登录
   - 导入项目仓库

2. **配置项目**
   - Framework Preset: Next.js
   - Root Directory: frontend
   - Build Command: `npm run build`
   - Output Directory: `.next`

3. **配置环境变量**
   - 添加 `NEXT_PUBLIC_API_URL`
   - 值：后端生产环境URL

4. **部署**
   - 点击Deploy
   - 等待部署完成

5. **验证**
   - 访问部署后的URL
   - 检查功能是否正常

**验收标准：**
- [ ] 部署成功
- [ ] 网站能正常访问
- [ ] 推荐列表正常显示
- [ ] API调用正常

---

### 第3步：后端部署（20分钟）

**负责人：后端工程师**

#### 方案A：Railway部署

**部署步骤：**
1. **创建账号**
   - 访问 https://railway.app
   - 使用GitHub账号登录

2. **创建项目**
   - New Project
   - Deploy from GitHub repo
   - 选择项目仓库

3. **配置服务**
   - Root Directory: backend
   - Start Command: `npm start`
   - Build Command: `npm install`

4. **配置环境变量**
   - PORT: 3001（自动）
   - OTA_PID: 284116645
   - NODE_ENV: production

5. **部署**
   - 自动部署
   - 获取部署URL

6. **验证**
   - 访问 `/health` 端点
   - 检查API是否正常

#### 方案B：Render部署

**部署步骤：**
1. **创建账号**
   - 访问 https://render.com
   - 使用GitHub账号登录

2. **创建Web Service**
   - New → Web Service
   - 连接GitHub仓库

3. **配置服务**
   - Name: travel-backend
   - Environment: Node
   - Build Command: `cd backend && npm install`
   - Start Command: `cd backend && npm start`
   - Root Directory: backend

4. **配置环境变量**
   - OTA_PID: 284116645
   - NODE_ENV: production

5. **部署**
   - 点击Create Web Service
   - 等待部署完成

6. **验证**
   - 访问 `/health` 端点
   - 检查API是否正常

**验收标准：**
- [ ] 部署成功
- [ ] API能正常访问
- [ ] 健康检查通过
- [ ] OTA链接生成正常

---

### 第4步：更新前端API地址（5分钟）

**负责人：前端工程师**

**操作步骤：**
1. 获取后端生产环境URL
2. 在Vercel环境变量中更新 `NEXT_PUBLIC_API_URL`
3. 触发重新部署

**验收标准：**
- [ ] 环境变量已更新
- [ ] 前端能正常调用后端API
- [ ] 推荐列表正常显示

---

### 第5步：生产环境验证（15分钟）

**负责人：全体成员**

**验证内容：**
1. **首页验证**
   - [ ] 访问生产环境URL
   - [ ] 推荐列表正常显示
   - [ ] 卡片信息完整
   - [ ] 占位图正常显示

2. **详情页验证**
   - [ ] 点击推荐卡片
   - [ ] 详情页正常显示
   - [ ] 信息完整
   - [ ] CTA按钮正常

3. **CTA跳转验证**
   - [ ] 点击"查看学生最低价"
   - [ ] 链接正常跳转
   - [ ] 链接包含正确PID
   - [ ] 所有CTA都能正常跳转

4. **移动端验证**
   - [ ] 移动端布局正常
   - [ ] 点击区域足够大
   - [ ] 体验良好

5. **API验证**
   - [ ] 后端API正常响应
   - [ ] 数据格式正确
   - [ ] 错误处理正常

**验收标准：**
- [ ] 所有功能正常
- [ ] 移动端体验良好
- [ ] OTA链接正确
- [ ] 无错误

---

## 🔍 监控准备

### 错误监控（可选）

**方案：Sentry**
- 免费套餐可用
- 自动捕获错误
- 错误通知

**配置步骤：**
1. 注册Sentry账号
2. 创建项目
3. 安装SDK
4. 配置错误上报

### 性能监控（可选）

**方案：Vercel Analytics**
- Vercel内置
- 免费使用
- 页面性能监控

### 访问统计（必须）

**方案：Google Analytics 或 简单日志**

**必须监控的3个指标：**
1. **首页推荐卡CTR**（点击率）
2. **CTA点击次数**
3. **是否真实跳到OTA**（哪怕只有1次）

**不要监控：**
- ❌ 转化率（那是OTA的事）
- ❌ 成交金额（那是OTA的事）
- ❌ 用户停留时间（不是核心指标）

---

## 📊 上线检查清单

### 部署前检查
- [ ] 代码已提交到GitHub
- [ ] 测试全部通过
- [ ] 环境变量已准备
- [ ] OTA PID已配置（284116645）

### 部署中检查
- [ ] 前端部署成功
- [ ] 后端部署成功
- [ ] 环境变量配置正确
- [ ] API地址更新正确

### 部署后检查
- [ ] 网站能正常访问
- [ ] 推荐列表正常显示
- [ ] 详情页正常显示
- [ ] CTA能正常跳转
- [ ] 移动端体验良好
- [ ] OTA链接正确
- [ ] 监控已配置

---

## ⚠️ 注意事项

### 安全注意事项
1. **环境变量安全**
   - 不要提交.env文件到Git
   - 使用平台的环境变量管理
   - OTA PID不要泄露

2. **API安全**
   - 配置CORS（后端已配置）
   - 考虑添加API限流
   - 监控异常请求

### 性能优化
1. **前端优化**
   - 图片优化（已使用Next.js Image）
   - 代码分割（Next.js自动）
   - CDN加速（Vercel自动）

2. **后端优化**
   - 缓存天气数据（已实现）
   - 数据库查询优化
   - API响应时间监控

---

## 📅 部署时间安排

### 今天（第3天）
- **上午：** 准备生产环境配置（30分钟）
- **下午：** 执行部署（1小时）
- **晚上：** 生产环境验证（15分钟）+ 数据观察

### 预计总时间
- **准备：** 30分钟
- **部署：** 1小时
- **验证：** 15分钟
- **总计：** 约2小时

---

## 🎯 上线目标

**核心目标：3天内必须能点出去**

**当前状态：**
- ✅ 功能开发完成
- ✅ 测试全部通过
- 🔄 准备部署上线

**上线后目标：**
- 能正常访问
- 能正常点击
- 能正常跳转OTA
- 能观察点击数据

---

## 📝 部署报告模板

### 部署结果
- **部署时间：** [填写]
- **部署人员：** [填写]
- **部署环境：** 生产环境

### 部署结果
- 前端部署：✅/❌
- 后端部署：✅/❌
- 环境变量配置：✅/❌
- 生产环境验证：✅/❌

### 发现的问题
1. [问题描述]
   - 状态：[已解决/待解决]

### 下一步行动
- [ ] 配置监控
- [ ] 观察数据
- [ ] 优化迭代

---

**开始时间：现在**
**目标：今天完成部署上线**

