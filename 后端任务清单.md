# 后端工程师任务清单

## 🎯 核心目标
**能读数据、能拼链接、能缓存天气**

---

## 第1阶段任务（3天内完成）

### 任务1.1：项目基础架构
**时间：第1天上午（1-2小时）**

**技术选型：**
- **Node.js + Express + SQLite**（推荐）
- 或 Python + FastAPI + JSON

**要求：**
- 极简架构，能跑就行
- 不需要复杂权限系统
- 不需要微服务

**交付标准：**
- [ ] 后端服务能启动
- [ ] 能返回JSON数据
- [ ] 能部署到线上

### 任务1.2：推荐列表API（核心）
**时间：第1天下午**

**API设计：**
```
GET /api/recommendations
Query Parameters:
  - origin: 出发地（可选）
  - type: 推荐类型（week/weekend/month/popular）

Response:
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": 1,
        "name": "杭州",
        "tag": "学生周末推荐",
        "budget_range": "600-800",
        "primary_reason": "预算600-800内可成行", // 必须包含
        "distance": 150,
        "transport": "高铁直达 · 1.5h",
        "weather": "未来两天晴",
        "suitable_days": "1-2天",
        "trust_signals": {
          "student_count": 120,
          "click_count_7d": 85,
          "is_popular": true,
          "is_student_favorite": true
        },
        "cover_image": "...",
        "cta_text": "查看学生最低价"
      }
    ]
  }
}
```

**关键要求：**
- ✅ 必须包含`primary_reason`字段（减少前端拼逻辑）
- ✅ 信任信号数据完整（但前端只显示1-2个）
- ✅ 根据type参数返回不同推荐

**数据来源（第一版）：**
- 从JSON文件或SQLite读取目的地数据
- 信任信号数据可以写死（内测数据）

**交付标准：**
- [ ] API能返回推荐列表
- [ ] 数据结构符合前端需求
- [ ] 至少返回10个推荐目的地
- [ ] 包含primary_reason字段

### 任务1.3：目的地详情API
**时间：第2天**

**API设计：**
```
GET /api/destinations/:id
Query Parameters:
  - origin: 出发地（用于计算距离）

Response:
{
  "code": 200,
  "data": {
    "id": 1,
    "name": "杭州",
    "summary": "适合预算800内、周末放松、不折腾",
    "recommend_reasons": [...],
    "itinerary": [...],
    "cta_links": {
      "hotel": "完整OTA链接（后端生成）",
      "transport": "完整OTA链接（后端生成）",
      "package": "完整OTA链接（后端生成）"
    }
  }
}
```

**关键要求：**
- ✅ 包含3个CTA链接字段
- ✅ **所有OTA链接必须后端统一生成**
- ✅ 所有pid/utm/source参数在后端

**交付标准：**
- [ ] API能返回目的地详情
- [ ] 包含3个CTA链接字段
- [ ] CTA链接格式正确

### 任务1.4：OTA跳转链接生成（尽早接）
**时间：第2-3天（重要）**

**要求：**
- 对接携程联盟（优先）
- 或飞猪/去哪儿联盟
- **后端统一生成**带返佣参数的跳转链接

**关键要求（必须遵守）：**
- ❌ **不要在前端拼返佣参数**
- ✅ **所有pid/utm/source只在后端**
- ✅ 从环境变量读取PID（避免泄露）
- ✅ 前端只拿`cta_links.hotel`等完整链接

**链接格式：**
```
https://hotels.ctrip.com/hotels/list?city=杭州&utm_source=travel_student&pid=YOUR_PID
```

**环境变量配置：**
```bash
OTA_PID=你的携程PID
```

**关键点：**
- ⚠️ 不要等"做完再接"
- 链接格式、跳转参数、平台限制最容易卡你
- 建议：哪怕只先接携程，哪怕只酒店/机票其中一个

**交付标准：**
- [ ] 能生成OTA跳转链接
- [ ] 链接包含返佣参数
- [ ] 前端能正常跳转
- [ ] PID从环境变量读取

### 任务1.5：天气API对接（简化版）
**时间：第3天（可选，可延后）**

**要求：**
- 对接一个天气API（和风天气/OpenWeatherMap）
- 列表页只显示简化天气（晴/多云/雨）
- 强制缓存2小时（减少API调用）

**交付标准：**
- [ ] 能获取天气数据
- [ ] 有缓存机制
- [ ] API失败时有降级方案

---

## 技术规范

### 技术栈
- **Node.js + Express**（推荐）
- 或 Python + FastAPI
- **数据库**：SQLite（初期）或 JSON文件

### API响应格式

**统一响应格式：**
```json
{
  "code": 200,
  "message": "success",
  "data": {...}
}
```

**错误响应：**
```json
{
  "code": 400,
  "message": "参数错误",
  "error": "具体错误信息"
}
```

### OTA链接生成规范

**必须后端统一生成：**
```javascript
const OTA_PID = process.env.OTA_PID || 'YOUR_PID';
const utm_source = 'travel_student';

const cta_links = {
  hotel: `https://hotels.ctrip.com/hotels/list?city=${encodeURIComponent(destination.name)}&utm_source=${utm_source}&pid=${OTA_PID}`,
  transport: `https://trains.ctrip.com/trainbooking/TrainList.aspx?from=${encodeURIComponent(origin)}&to=${encodeURIComponent(destination.name)}&utm_source=${utm_source}&pid=${OTA_PID}`,
  package: `https://vacations.ctrip.com/list?dest=${encodeURIComponent(destination.name)}&utm_source=${utm_source}&pid=${OTA_PID}`
};
```

### 数据文件位置
- 目的地数据：`data/destinations.json`
- 环境变量：`.env`（不要提交到Git）

---

## 验收标准

### API验收
- [ ] 推荐API能正常返回数据
- [ ] 详情API能正常返回数据
- [ ] 数据结构符合前端需求
- [ ] 包含primary_reason字段

### OTA链接验收
- [ ] OTA链接能正常生成
- [ ] 链接包含返佣参数
- [ ] PID从环境变量读取
- [ ] 前端能正常跳转

### 服务验收
- [ ] 服务稳定运行
- [ ] 错误处理完善
- [ ] 能部署到线上

---

## 时间节点

- **第1天**：架构 + 推荐API
- **第2天**：详情API + OTA链接
- **第3天**：天气API（可选）+ 优化

---

**开始时间：现在**
**目标：3天内必须能点出去**



